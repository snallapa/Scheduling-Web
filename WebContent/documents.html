<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Participants</title>
		<meta name="description" content="My Parse App">
		<meta name="viewport" content="width=device-width">
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/residents.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>
		<script src="js/parse.js" type="text/javascript"></script>
		<script src="js/jspdf.min.js"></script>
		<script src="js/scheduling.js"></script>
		<script type="text/javascript" src="js/standard_fonts_metrics.js"></script>
		<script type="text/javascript" src="js/split_text_to_size.js"></script>
		<script type="text/javascript" src="js/from_html.js"></script>
		<script src="js/jspdf.debug.js"></script>
		<script src="js/html2canvas.min.js"></script>
	</head>
	<body>
		<body>
			<nav class="navbar navbar-inverse navbar-fixed-top">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
						aria-controls="navbar">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#">Scheduling</a>
					</div>
					<div id="navbar" class="navbar-collapse collapse">
						<ul class="nav navbar-nav navbar-right">
							<li class="active">
								<a href="documents.html">Scheduling</a>
							</li>
							<li>
								<a href="rosters.html">Rosters</a>
							</li>
							<form class="navbar-form navbar-right signOutForm">
								<button type="submit" class="btn btn-link signOut">Sign out</button>
							</form>
						</ul>
					</div>
					<div id="navbar" class="navbar-collapse collapse"></div>
					<!--/.navbar-collapse -->
				</div>
			</nav>
			<!-- Main jumbotron for a primary marketing message or call to action -->
			<div class="container">
				<div class=residentsScheduling>
					<div class="alert alert-success alert-dismissible deleteResident" role="alert">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<strong>Success!</strong>&nbsp;The resident was deleted.</div>
					<div class="alert alert-success alert-dismissible savedSchedule" role="alert">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<strong>Success!</strong>&nbsp;The schedule was saved.</div>
					<div class="alert alert-danger alert-dismissible scheduleNotSaved" role="alert">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<strong>Oh No!</strong>&nbsp;The schedule was not saved.</div>
					<div class="alert alert-danger alert-dismissible residentNotDeleted"
					role="alert">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<strong>Oh No!</strong>&nbsp;The resident was not removed.</div>
					<div class="alert alert-danger alert-dismissible residentWarning"
					role="alert">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<p>
							<strong>Wait!</strong>&nbsp;Are you sure you want to delete this resident? This action cannot be undone (but you can always add
							another one).</p>
						<p>
							<button type="button" class="btn btn-danger actuallyRemoveResident">Remove Resident</button>
							<button type="button" class="btn btn-default closeWarning">Cancel</button>
						</p>
					</div>
					<div class="alert alert-danger alert-dismissible clearWarning" role="alert">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<p>
							<strong>Wait!</strong>&nbsp;Are you sure you want to clear this schedule? Once saved, there is no going back.</p>
						<p>
							<button type="button" class="btn btn-danger actuallyClearSchedule">Clear Schedule</button>
							<button type="button" class="btn btn-default closeWarning">Cancel</button>
						</p>
					</div>
					<div class="residentsList">
						<div class="list-group-item">
							<div class="displayText">
								<a class="addUserLink" data-toggle="modal" data-target="#myModal"><span
							class="glyphicon glyphicon-plus" aria-hidden="true"></span></a>
								<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal" aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
												<h4 class="modal-title" id="myModalLabel">Add a New User</h4>
											</div>
											<div class="modal-body">
												<div class="alert alert-danger alert-dismissible residentNotAdded" role="alert">
													<button type="button" class="close" data-dismiss="alert" aria-label="Close">
														<span aria-hidden="true">&times;</span>
													</button>
													<strong>Oh No!</strong>The resident could not be added. Enter a color and a name for each resident</div>
												<form>
													<div class="form-group">
														<label for="name">Name</label>
														<input type="text" class="form-control" id="name" placeholder="Enter Name">
													</div>
													<br>
													<div class="form-group">
														<label for="contactPicture">Resident Contact Picture</label>
														<input type="file" id="contactPicture">
														<p class="help-block">Upload a jpg file of the resident.</p>
													</div>
													<div id="imagePreview"></div>
												</form>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-default clearModalButton" data-dismiss="modal">Close</button>
												<button type="button" class="btn btn-primary userButton clearModalButton">Add User</button>
											</div>
										</div>
									</div>
								</div>
								<div class="form-group horizontalFix">
									<input type="text" class="form-control" id="search" name="search" placeholder="Search" data-list=".list-group">
								</div>
							</div>
						</div>
						<div class="list-group"></div>
					</div>
					<div class="residentsSchedule">
						<table id="schedule" class="table tableFix">
							<thead>
								<tr>
									<th>Time</th>
									<th>Monday</th>
									<th>Tuesday</th>
									<th>Wednesday</th>
									<th>Thursday</th>
									<th>Friday</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="times">9:30 - 10:30</td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
								</tr>
								<tr>
									<td class="times">10:30 - 11:30</td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
								</tr>
								<tr>
									<td class="times">11:30 - 12:00</td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
								</tr>
								<tr>
									<td class="times">12:00 - 12:30</td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
								</tr>
								<tr>
									<td class="times">12:30 - 1:30</td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
								</tr>
								<tr>
									<td class="times">1:30 - 2:30</td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
									<td class="clearable"></td>
								</tr>
							</tbody>
							<tfoot>
								<tr>
									<th>
										<button type="button" class="btn btn-danger btn-sm removeResident" data-html2canvas-ignore="true">Remove Resident</button>
									</th>
									<th class="th-fix">
										<button type="button" class="btn btn-info btn-sm editSchedule" data-html2canvas-ignore="true" data-toggle="modal" data-target="#editModal">Edit Resident</button>
										<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
										aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<button type="button" class="close" data-dismiss="modal" aria-label="Close">
															<span aria-hidden="true">&times;</span>
														</button>
														<h4 class="modal-title" id="myModalLabel">Edit User</h4>
													</div>
													<div class="modal-body">
														<div class="alert alert-danger alert-dismissible residentNotEdited" role="alert">
															<button type="button" class="close" data-dismiss="alert" aria-label="Close">
																<span aria-hidden="true">&times;</span>
															</button>
															<strong>Oh No!</strong>The resident could not be edited. Enter a color and a name for each resident</div>
														<form>
															<div class="form-group">
																<label for="name">New Name</label>
																<input type="text" class="form-control" id="newName" placeholder="">
															</div>
															<br>
															<div class="form-group">
																<label for="contactPicture">Resident Contact Picture</label>
																<input type="file" id="newcontactPicture">
																<p class="help-block">Upload a jpg file of the resident.</p>
															</div>
															<div id="newimagePreview" class="imagePreview"></div>
														</form>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-default clearModalButton" data-dismiss="modal">Close</button>
														<button type="button" class="btn btn-primary editUserButton clearModalButton">Edit User</button>
													</div>
												</div>
											</div>
										</div>
									</th>
									<th></th>
									<th>
										<button type="button" class="btn btn-primary btn-sm exportSchedule"data-html2canvas-ignore="true">Export</button>
									</th>
									<th>
										<button type="button" class="btn btn-warning btn-sm clearSchedule"data-html2canvas-ignore="true">Clear Schedule</button>
									</th>
									<th>
										<button type="button" class="btn btn-success btn-sm saveSchedule"data-html2canvas-ignore="true">Save Schedule</button>
									</th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
			<!-- Bootstrap core JavaScript==================================================- ->
	<!-- Placed at the end of the document so the pages load faster -->
			<script src="js/bootstrap.min.js"></script>
			<script type="text/javascript" src="js/editableTable.js"></script>
			<script src="js/jquery.hideseek.min.js"></script>
			<script>
				$('#search').hideseek();
			</script>
			<script>
				$(".exportSchedule").click(function () {
					var text = $("#residentChosen").text() + "";
					var canvasToImage = function(canvas){
        var img = new Image();
        var dataURL = canvas.toDataURL('image/png');
        img.src = dataURL;
        return img;
    };
var canvasShiftImage = function(oldCanvas, shiftAmt, realPdfPageHeight) {
        shiftAmt = parseInt(shiftAmt) || 0;
        if(!shiftAmt){ return oldCanvas; }
        
        var newCanvas = document.createElement('canvas');
        newCanvas.height = oldCanvas.height - shiftAmt;
        newCanvas.width = oldCanvas.width;
        var ctx = newCanvas.getContext('2d');
        
        var img = canvasToImage(oldCanvas);
        ctx.drawImage(img,0, shiftAmt, img.width, img.height, 0, 0, img.width, img.height);
        
        return newCanvas;
};

var html2canvasSuccess = function (canvas) {
    var pdf = new jsPDF("l", "pt", "letter"),
        pdfInternals = pdf.internal,
        pdfPageSize = pdfInternals.pageSize,
        pdfScaleFactor = pdfInternals.scaleFactor/5,
        pdfPageWidth = pdfPageSize.width,
        pdfPageHeight = pdfPageSize.height,
        totalPdfHeight = 0,
        htmlPageHeight = canvas.height,
        htmlScaleFactor = canvas.width / (pdfPageWidth * pdfScaleFactor);

    while (totalPdfHeight < htmlPageHeight) {
        var newCanvas = canvasShiftImage(canvas, totalPdfHeight, pdfPageHeight * pdfScaleFactor);
		//var centered_x = (pdfPageSize.width / 2) - (400*newCanvas.width/newCanvas.height * pdfScaleFactor/2);
		var textWidth = pdf.getStringUnitWidth(text) * pdf.internal.getFontSize() / pdf.internal.scaleFactor;
    	var textOffset = (pdf.internal.pageSize.width - textWidth) / 2;
		pdf.text(textOffset, 50, text);
        pdf.addImage(newCanvas, 'png',75,80, pdfPageWidth - 150, pdfPageHeight - 200, null, 'NONE'); //note the format doesn't seem to do anything... I had it at 'pdf' and it didn't care

        totalPdfHeight += (pdfPageHeight * pdfScaleFactor * htmlScaleFactor);

        if (totalPdfHeight < htmlPageHeight) { pdf.addPage(); }
    }

    pdf.save('test.pdf');
};


html2canvas($('#schedule')[0], {
    onrendered: function (canvas) {
        html2canvasSuccess(canvas);
    }
});

					});
			</script>
		</body>

</html>